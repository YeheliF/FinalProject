<!DOCTYPE html> 
<html> 
<head> 
    <title>הטיסות שלי</title> 
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> 
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"> 
 </script> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> 
    <link rel="shortcut icon" href="/assets/favicon.ico"> 
    <link rel="stylesheet" href="/style.css"> 
    <style>
		body        { padding-top:70px; }
	</style>
</head> 
<body> 
  <div> 
    <p class="lead mb-3"><%=userName%> אלו הטיסות שלך  </p>
  </div> 
  <%- include ('./partials/messages') %>
   <form id="form4" method="post" action="/myFlights" size="1000"> 
                <a href="addFlight" class="home__button">הוספת טיסה חדשה</a> 
                <table class="table">
                    <h2>טיסות עתידיות</h2> 
                    <thead> 
                        <tr>  
                            <th scope="col">תחזית</th> 
                            <th scope="col">טרמינל</th>  
                            <th scope="col">זמן נחיתה</th>  
                            <th scope="col">יעד</th>  
                            <th scope="col">זמן המראה</th> 
                            <th scope="col">מקור</th>  
                            <th scope="col">מספר טיסה</th>  
                            <th scope="col">תאריך</th>  

                        </tr> 
                    </thead> 
                    <tbody> 
                        <tr> 
                            <%items.forEach(flight =>{%> 
                            <%if(flight.idUser == id){%> 
                                
                            <%if(!((flight.Date.split("-")[0] == new Date().getFullYear() && flight.Date.split("-")[1] == new Date().getMonth()+1 && flight.Date.split("-")[2] < new Date().getDate()) || flight.Date.split("-")[0] < new Date().getFullYear() || (flight.Date.split("-")[0] == new Date().getFullYear() && flight.Date.split("-")[1] < new Date().getMonth())) ){%>
                            
                                <th scope="row"><%= machinePred = flight.machinePred %></th>
                                <th scope="row"><%= terminal = flight.Terminal %></th> 
                                <th scope="row"><%= arrTime = flight.ArrivalTime %></th> 
                                <th scope="row"><%= arr = flight.Arrival %></th>
                                <th scope="row"><%= depTime = flight.DepartureTime %></th>
                                <th scope="row"><%= dep = flight.Departure %></th>
                                <th scope="row"><a href="summaryFlight" + {date,num,dep,depTime,arr,arrTime,terminal,machinePred}><%= num = flight.flightNumber %></a>  <a href= "/deleteFlight?date=<%= date %>&num=<%= num%>">הסר טיסה</a></th> 
                                <th scope="row"><%= date = flight.Date %></th> 
                                <!-- <th><a href= "/deleteFlight?date=<%= date %>&num=<%= num%>">הסר טיסה</a></th>   -->
                                
                                <%if(flight.delayHourUpdate){%>
                                    <tr><td class="complain__button">
                                         שים לב!!! הטיסה מתעכבת לשעה:<%=flight.delayHourUpdate %>
                                    </td></tr>
                                <%}%>
                            </tr>
                            
                            <%}%> 
                            
                             
                            <%}%> 
                            
                            <%})%> 
         
                        </tr> 
         
                    </tbody> 
                </table> 
                <table class="table"> 
                    <h2>טיסות עבר</h2>
                    <thead> 
                        <tr>
                            <th scope="col"></th>   
                            <th scope="col">טרמינל</th>  
                            <th scope="col">זמן נחיתה</th>  
                            <th scope="col">יעד</th>  
                            <th scope="col" colspan="2">זמן המראה\n תוכנן | בפועל</th> 
                            <th scope="col">מקור</th>  
                            <th scope="col">מספר טיסה</th>  
                            <th scope="col">תאריך</th>  

                        </tr> 
                    </thead> 
                    <tbody> 
                       
                            <%items.forEach(flight =>{%> 
                            <%if(flight.idUser == id){%> 
                            <%if((flight.Date.split('-')[0] == new Date().getFullYear() && flight.Date.split('-')[1] == new Date().getMonth()+1 && flight.Date.split('-')[2] < new Date().getDate()) || flight.Date.split('-')[0] < new Date().getFullYear() || (flight.Date.split('-')[0] == new Date().getFullYear() && flight.Date.split('-')[1] < new Date().getMonth()) ){%>
                            <%var startTime = moment(flight.DepartureTime, 'HH:mm a');%> 
                            <%var endTime = moment(flight.delayHourUpdate, 'HH:mm a');%> 

                            <%var duration = moment.duration(endTime.diff(startTime));%> 

                            <%var hours = parseInt(duration.asHours());%>
                            <%console.log(hours)%> 
                            <%if(hours>6){%>
                                
                                
                                    <th scope="row" class="complain__button"><a href="report" + {date,num,dep,depTime,arr,arrTime,terminal}>הנך זכאי לפיצוי, אנא הגש תלונה</a></th>                                     
                                <%}else{%> 
                                    <th scope="row"></th> 
                                <%}%> 
                            
                                <% delayHourUpdate = flight.delayHourUpdate %>
                                <th scope="row"><%= terminal = flight.Terminal %></th> 
                                <th scope="row"><%= arrTime = flight.ArrivalTime %></th> 
                                <th scope="row"><%= arr = flight.Arrival %></th>
                                <th scope="row"><%= depTime = flight.delayHourUpdate %></th>
                                <th scope="row"><%= depTime = flight.DepartureTime %></th>
                                <th scope="row"><%= dep = flight.Departure %></th>
                                <th scope="row"><a href="flightDetailsPast" + {date,num,dep,depTime,arr,arrTime,terminal,delayHourUpdate}><%= num = flight.flightNumber %></a>  ---  <a href= "/deleteFlight?date=<%= date %>&num=<%= num%>">הסר טיסה</a></th> 
                                <th scope="row"><%= date = flight.Date %></th> 
                                <!-- <th><a href= "/deleteFlight?date=<%= date %>&num=<%= num%>">הסר טיסה</a></th>    -->
                                
                            </tr>    
                            <%}%> 
                            <%}%> 
                            <%})%> 
         
                        </tr> 
         
                    </tbody> 
                </table> 

                
   </form> 
  <div class="abc"> 
            <a href="/logout">התנתק</a> 
    </div> 
 </div> 
</body> 
</html>